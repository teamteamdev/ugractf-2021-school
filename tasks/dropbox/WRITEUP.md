# Dropbox: Write-up

Сайт позиционирует себя как лучший файлообменник, предлагая загрузить 
файл и в ответ получить ссылку, по которой этим файлом можно будет делиться с друзьями.

Загружаем файл и видим, что ссылки генерируются в формате `/getfile?filename=имя_файла`. 
Сразу понимаем, что это возможность для [Path Traversal Attack](https://owasp.org/www-community/attacks/Path_Traversal),
поэтому проверим, есть ли у нас доступ к файловой системе, поставив в аргумент `filename` значение 
`../`. Получаем ответ:
```angular2html
Документ с имя ..O не обнаружен.
```
Почему-то символ `/` преобразовался в символ `O`. Пока не совсем понятно, почему — 
поэтому попробуем отправить ещё пару запросов.  

`../../` → `Документ с имя ../..O не обнаружен.`  
`../12345` → `Документ с имя ..OQRSTU не обнаружен.`  
`123.45.12345` → `Документ с имя 123.45.QRSTU не обнаружен.`  
`../flag.txt` → `Документ с имя ../flag.txt не обнаружен.`  
`flag.txt` → `Документ с имя flag.txt не обнаружен.`

Замечаем две закономерности: преобразования никогда не касаются строчных букв и 
всегда происходят после последней точки. Попробуем сопоставить преобразованные символы 
с исходными: видим, что код преобразованного символа равен сумме кода исходного символа 
и числа `32` в десятичной системе счисления. Таким образом, чтобы получить символ `.` (код `46`), 
мы можем отправить серверу символ с кодом `14` в десятичной системе счисления или `0xE` в шестнадцатеричной. 
Аналогично, символу `/` (код `47`) соответствует символ с кодом `15` или `0xF`. 

Используем полученные знания и построим запрос, который, например, достанет для нас файл `/etc/passwd`:
`/getfile?filename=../../../../../.%0E%0Fetc0%Fpasswd`.

Скачиваем файл и получаем флаг.

Флаг: **ugra_dvoinoi_ris_etot_gospodinae15adb72caf**

# Постмортем

По преобразованиям можно догадаться, что сайт таким образом преобразует заглавные буквы (а точнее все **не строчные**) 
в расширении файла в строчные. В ходе решения таска нужно было заметить эту уязвимость и использовать её. 
Однако, в ходе разработки не был учтён вариант, в котором пользователь запрашивает сразу полный путь к файлу, 
например `/etc/passwd`. Так как в строке нет точек, мы не можем определить расширение в имени файла 
и просто не преобразовываем его, открывая доступ к файловой системе. Из-за этого таск оказался намного проще, 
чем должен был быть изначально.
